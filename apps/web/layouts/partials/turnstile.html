{{/* Cloudflare Turnstile - lazy load when contact section approaches viewport */}}
{{ if .Site.Params.turnstileSiteKey }}
<script>
  (function() {
    var loaded = false;
    function loadTurnstile() {
      if (loaded) return;
      loaded = true;
      var s = document.createElement('script');
      s.src = 'https://challenges.cloudflare.com/turnstile/v0/api.js';
      s.async = true;
      document.head.appendChild(s);
    }
    // Load when contact section is 500px from viewport
    var observer = new IntersectionObserver(function(entries) {
      if (entries[0].isIntersecting) {
        loadTurnstile();
        observer.disconnect();
      }
    }, { rootMargin: '500px' });
    document.addEventListener('DOMContentLoaded', function() {
      var contact = document.getElementById('contact');
      if (contact) observer.observe(contact);
    });
  })();
</script>
{{ end }}
